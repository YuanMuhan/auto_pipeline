app_name: smart_home_security_automation
version: "1.0"
components:
  - id: door_sensor_main
    type: binary_sensor
    capabilities:
      - detect_open_close
      - sense
  - id: motion_sensor_living
    type: motion_sensor
    capabilities:
      - detect_motion
      - sense
  - id: smart_light_living
    type: actuator_light
    capabilities:
      - actuate
  - id: edge_gateway_ha
    type: gateway_homeassistant
    capabilities:
      - collect
      - filter
      - decide
      - aggregate
  - id: cloud_automation_service
    type: server_automation
    capabilities:
      - analyze
      - decide
      - notify
  - id: cloud_storage_service
    type: server_database
    capabilities:
      - store
      - query
links:
  - id: door_state_to_edge
    from: door_sensor_main
    to: edge_gateway_ha
    data_type: sensor_reading
    frequency: real-time
  - id: motion_state_to_edge
    from: motion_sensor_living
    to: edge_gateway_ha
    data_type: sensor_reading
    frequency: real-time
  - id: edge_light_control
    from: edge_gateway_ha
    to: smart_light_living
    data_type: command
    frequency: on-demand
  - id: edge_events_to_cloud
    from: edge_gateway_ha
    to: cloud_automation_service
    data_type: event
    frequency: real-time
  - id: cloud_notification_out
    from: cloud_automation_service
    to: external_notification_service
    data_type: notification
    frequency: on-demand
  - id: cloud_data_to_storage
    from: cloud_automation_service
    to: cloud_storage_service
    data_type: aggregated_data
    frequency: periodic
  - id: storage_query_to_cloud
    from: cloud_storage_service
    to: cloud_automation_service
    data_type: query_result
    frequency: on-demand
logic:
  modes:
    home_mode:
      description: 在家模式：夜间人体感应开灯
      rules:
        - condition: time_window(22:00-06:00) AND motion_detected
          action: turn_on_light
        - condition: no_motion_for(5_minutes)
          action: turn_off_light
    away_mode:
      description: 离家模式：任何门磁触发均告警
      rules:
        - condition: door_state_changed
          action: send_notification
        - condition: motion_detected
          action: send_high_priority_alert
    security_mode:
      description: 安防模式：双重传感器联动
      rules:
        - condition: door_opened AND motion_detected
          action: trigger_alarm_and_record
        - condition: consecutive_anomalies
          action: notify_emergency_contact
  fault_tolerance:
    - condition: sensor_offline
      action: use_backup_policy
metadata:
  description: 智能家居安防自动化系统IR
  category: smart_home_automation
  priority: high