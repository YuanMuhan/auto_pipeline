version: '3.8'

services:

  cloud_service:
    build:
      context: ./generated_code/cloud
      dockerfile: Dockerfile
    container_name: autopipeline_cloud
    environment:
      - LAYER=CLOUD
      - SERVICE_NAME=cloud_service
    volumes:
      - ./generated_code/cloud:/app
    # TODO: Add port mappings based on endpoints
    # ports:
    #   - "8080:8080"
    networks:
      - autopipeline_network
    restart: unless-stopped

  edge_service:
    build:
      context: ./generated_code/edge
      dockerfile: Dockerfile
    container_name: autopipeline_edge
    environment:
      - LAYER=EDGE
      - SERVICE_NAME=edge_service
    volumes:
      - ./generated_code/edge:/app
    # TODO: Add port mappings based on endpoints
    # ports:
    #   - "8080:8080"
    networks:
      - autopipeline_network
    restart: unless-stopped

  device_service:
    build:
      context: ./generated_code/device
      dockerfile: Dockerfile
    container_name: autopipeline_device
    environment:
      - LAYER=DEVICE
      - SERVICE_NAME=device_service
    volumes:
      - ./generated_code/device:/app
    # TODO: Add port mappings based on endpoints
    # ports:
    #   - "8080:8080"
    networks:
      - autopipeline_network
    restart: unless-stopped

networks:
  autopipeline_network:
    driver: bridge

# TODO: Add volumes if needed for persistent storage
# volumes:
#   data_volume:

# Transport protocols used:
# - link_sensor_to_processor: MQTT (QoS: at_least_once)
# - link_processor_to_storage: HTTP (QoS: best_effort)
