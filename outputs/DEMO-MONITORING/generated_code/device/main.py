#!/usr/bin/env python3
# bindings_hash: 6f087fc835dba5db70c9ae2adde3937a526461f72c3b73736849898c51acdc3a
# endpoints_used_preview: device://temp_sensor_01/data, device://temp_sensor_01/data, edge://gateway_01/input
# Generated code for DEVICE layer
# Auto-generated by AutoPipeline CodeGen

import json
import time
from typing import Dict, Any


class DeviceService:
    """
    Service running on device layer

    Components handled:
    - sensor_collector: data_source (capabilities: sense, collect)
    """

    def __init__(self):
        self.running = False
        print(f"[DEVICE] Service initialized")

    def start(self):
        """Start the service"""
        self.running = True
        print(f"[DEVICE] Service started")

        # TODO: Initialize connections to endpoints
        # TODO: Connect to endpoint: device://temp_sensor_01/data -> edge://gateway_01/input

        self.run()

    def run(self):
        """Main service loop"""
        while self.running:
            # TODO: Implement main logic
            # TODO: Execute sensor_collector capabilities: sense, collect

            time.sleep(1)  # Placeholder loop

    def communicate_via_link_sensor_to_processor(self, data: Dict[str, Any]):
        """
        Send data via link_sensor_to_processor
        Protocol: MQTT
        From: device://temp_sensor_01/data
        To: edge://gateway_01/input
        """
        # TODO: Implement MQTT communication
        print(f"[DEVICE] Sending data via MQTT: {data}")

        # Placeholder for actual implementation:
        # mqtt_client.publish(topic="edge://gateway_01/input", payload=json.dumps(data))
        pass


if __name__ == "__main__":
    service = DeviceService()
    try:
        service.start()
    except KeyboardInterrupt:
        print(f"[DEVICE] Service stopped")
