components:
  - id: door_sensor_main
    type: DoorContact
    capabilities:
      - sense
      - collect
    metadata:
      description: 主卧门磁传感器
  - id: motion_sensor_living
    type: MotionSensor
    capabilities:
      - sense
      - collect
    metadata:
      description: 客厅人体传感器
  - id: smart_light_living
    type: Light
    capabilities:
      - actuate
    metadata:
      description: 客厅智能灯
  - id: edge_gateway_ha
    type: RuleEngine
    capabilities:
      - analyze
      - decide
      - route
    metadata:
      description: 边缘网关逻辑处理
  - id: cloud_automation_service
    type: Notifier
    capabilities:
      - analyze
      - notify
    metadata:
      description: 云端通知服务
  - id: cloud_storage_service
    type: DataStore
    capabilities:
      - store
      - query
    metadata:
      description: 云端存储服务
  - id: system_mode_scheduler
    type: TimeScheduler
    capabilities:
      - schedule
    metadata:
      description: 系统模式调度器

links:
  - id: door_state_to_edge
    from: door_sensor_main
    to: edge_gateway_ha
    data_type: sensor_event
    frequency: real-time
    contract:
      event_type: door_state_change
  - id: motion_state_to_edge
    from: motion_sensor_living
    to: edge_gateway_ha
    data_type: sensor_event
    frequency: real-time
    contract:
      event_type: motion_detected
  - id: edge_to_light_control
    from: edge_gateway_ha
    to: smart_light_living
    data_type: command
    frequency: on-demand
    contract:
      command_type: light_control
  - id: edge_to_cloud_events
    from: edge_gateway_ha
    to: cloud_automation_service
    data_type: event
    frequency: real-time
    contract:
      event_category: security_alert
  - id: edge_to_cloud_storage
    from: edge_gateway_ha
    to: cloud_storage_service
    data_type: sensor_reading
    frequency: periodic
    contract:
      data_type: time_series
  - id: scheduler_to_edge_mode
    from: system_mode_scheduler
    to: edge_gateway_ha
    data_type: event
    frequency: periodic
    contract:
      event_type: mode_change
  - id: cloud_to_edge_query
    from: cloud_storage_service
    to: edge_gateway_ha
    data_type: query_result
    frequency: on-demand
    contract:
      query_type: historical_data

logic:
  modes:
    home_mode:
      description: 在家模式：夜间人体感应开灯
      rules:
        - condition: time_period(22:00-06:00) AND motion_detected
          action: turn_on_light
        - condition: no_motion_for(5_minutes)
          action: turn_off_light
    away_mode:
      description: 离家模式：任何门磁触发均告警
      rules:
        - condition: door_state_change
          action: send_notification
        - condition: motion_detected
          action: send_high_priority_alert
    security_mode:
      description: 安防模式：双重传感器联动
      rules:
        - condition: door_state_change AND motion_detected
          action: trigger_alarm
        - condition: consecutive_anomalies
          action: notify_emergency_contact
  fault_handling:
    - condition: sensor_offline
      action: use_backup_strategy
    - condition: sensor_fault
      action: send_fault_notification

metadata:
  description: 智能家居安防自动化系统中间表示
  version: "1.0"
  category: smart_home_automation
  priority: high