components:
  - id: door_sensor_main
    type: DoorContact
    capabilities:
      - sense
      - collect
    metadata:
      description: 主卧门磁传感器
  - id: motion_sensor_living
    type: MotionSensor
    capabilities:
      - sense
      - collect
    metadata:
      description: 客厅人体传感器
  - id: smart_light_living
    type: Light
    capabilities:
      - actuate
    metadata:
      description: 客厅智能灯
  - id: edge_gateway_ha
    type: RuleEngine
    capabilities:
      - collect
      - filter
      - decide
    metadata:
      description: 边缘规则引擎
  - id: cloud_automation_service
    type: Notifier
    capabilities:
      - analyze
      - decide
    metadata:
      description: 云端通知服务
  - id: cloud_storage_service
    type: DataStore
    capabilities:
      - store
      - query
    metadata:
      description: 云端存储服务
  - id: system_scheduler
    type: TimeScheduler
    capabilities:
      - schedule
    metadata:
      description: 系统时间调度器
  - id: security_controller
    type: RuleEngine
    capabilities:
      - analyze
      - decide
    metadata:
      description: 安防模式控制器

links:
  - id: door_state_to_edge
    from: door_sensor_main
    to: edge_gateway_ha
    data_type: sensor_reading
    frequency: real-time
  - id: motion_state_to_edge
    from: motion_sensor_living
    to: edge_gateway_ha
    data_type: sensor_reading
    frequency: real-time
  - id: edge_to_light_control_home
    from: edge_gateway_ha
    to: smart_light_living
    data_type: command
    frequency: on-demand
  - id: edge_to_cloud_events
    from: edge_gateway_ha
    to: cloud_automation_service
    data_type: event
    frequency: real-time
  - id: edge_to_cloud_storage
    from: edge_gateway_ha
    to: cloud_storage_service
    data_type: sensor_reading
    frequency: periodic
  - id: scheduler_to_edge
    from: system_scheduler
    to: edge_gateway_ha
    data_type: event
    frequency: periodic
  - id: edge_to_security_controller
    from: edge_gateway_ha
    to: security_controller
    data_type: event
    frequency: real-time
  - id: security_to_notifier
    from: security_controller
    to: cloud_automation_service
    data_type: command
    frequency: on-demand
  - id: cloud_query_to_storage
    from: cloud_automation_service
    to: cloud_storage_service
    data_type: query
    frequency: on-demand

logic:
  modes:
    home_mode:
      description: 在家模式：夜间人体感应开灯
      rules:
        - condition: time_period(22:00-06:00) AND motion_detected
          action: turn_on_light
        - condition: no_motion_for(5_minutes)
          action: turn_off_light
    away_mode:
      description: 离家模式：任何门磁触发均告警
      rules:
        - condition: door_state_changed
          action: send_notification_immediate
        - condition: motion_detected
          action: send_notification_high_priority
    security_mode:
      description: 安防模式：双重传感器联动
      rules:
        - condition: door_open AND motion_detected
          action: trigger_alarm_and_record
        - condition: consecutive_anomalies
          action: notify_emergency_contact
  fault_handling:
    - condition: sensor_offline
      action: use_backup_strategy
      fallback: notify_fault

metadata:
  description: 智能家居安防自动化系统IR
  version: "1.0"
  priority: high
  category: smart_home_automation