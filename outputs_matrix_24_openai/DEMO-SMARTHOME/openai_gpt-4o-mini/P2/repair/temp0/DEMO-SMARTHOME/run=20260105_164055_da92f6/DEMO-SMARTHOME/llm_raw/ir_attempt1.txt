app_name: smart_home_security_automation
version: 1.0
components:
  - id: door_sensor_main
    type: data_source
    capabilities:
      - detect_open_close
      - battery_powered
    metadata:
      description: 主卧门磁传感器

  - id: motion_sensor_living
    type: data_source
    capabilities:
      - detect_motion
      - illuminance_sensing
      - battery_powered
    metadata:
      description: 客厅人体传感器

  - id: smart_light_living
    type: actuator
    capabilities:
      - turn_on_off
      - dimming
      - color_temp
    metadata:
      description: 客厅智能灯

  - id: edge_gateway_ha
    type: controller
    capabilities:
      - event_bus
      - automation
      - state_management
    metadata:
      description: Home Assistant 边缘网关

  - id: cloud_automation_service
    type: processor
    capabilities:
      - rule_engine
      - notification
      - data_storage
      - analytics
    metadata:
      description: 云端自动化服务

  - id: cloud_storage_service
    type: storage
    capabilities:
      - time_series_db
      - query
      - aggregation
    metadata:
      description: 云端存储服务

links:
  - id: link_door_sensor_to_gateway
    from: door_sensor_main
    to: edge_gateway_ha
    data_type: sensor_reading
    frequency: real-time

  - id: link_motion_sensor_to_gateway
    from: motion_sensor_living
    to: edge_gateway_ha
    data_type: sensor_reading
    frequency: real-time

  - id: link_gateway_to_light
    from: edge_gateway_ha
    to: smart_light_living
    data_type: command
    frequency: real-time

  - id: link_gateway_to_cloud_service
    from: edge_gateway_ha
    to: cloud_automation_service
    data_type: event
    frequency: real-time

  - id: link_cloud_service_to_storage
    from: cloud_automation_service
    to: cloud_storage_service
    data_type: data_storage
    frequency: periodic

logic:
  home_mode:
    description: 在家模式：夜间人体感应开灯
    rules:
      - condition: 时间段 22:00-06:00 且检测到人体活动
        action: 开灯
      - condition: 无人体活动超过5分钟
        action: 关灯

  away_mode:
    description: 离家模式：任何门磁触发均告警
    rules:
      - condition: 门磁状态变化
        action: 立即发送推送通知
      - condition: 人体传感器触发
        action: 高优先级警报

  security_mode:
    description: 安防模式：双重传感器联动
    rules:
      - condition: 门磁打开 AND 人体检测
        action: 触发警报 + 录像
      - condition: 连续异常
        action: 通知紧急联系人

metadata:
  description: 智能家居安防自动化系统
  priority: high
  category: smart_home_automation